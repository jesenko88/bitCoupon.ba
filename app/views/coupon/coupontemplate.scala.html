@(coupon: Coupon)
@import models.comments._
@import models._
@import models.questions._
@import java.math.BigInteger; var i=0
@main("Welcome to bitCoupon") {
	
<header id="header">
<link href="@routes.Assets.at("css/star-rating.css")" rel="stylesheet">
      <link href="@routes.Assets.at("css/star-rating.min.css")" rel="stylesheet">
      <script src="@routes.Assets.at("js/star-rating.js")"></script>
      <script src="@routes.Assets.at("js/star-rating.min.js")"></script>
   <!--header-->
   <div class="header-middle">
      <!--header-middle-->
      <div class="container">
         <a href="/"><img src="@routes.Assets.at("images/home/logo.png")" alt="" /></a>
         <div class="logo pull-right">
            <div class="search_box">
               <form action="/search" method="GET">
                  <input id="q" name="q" type="text" placeholder="Search" />
               </form>
            </div>
         </div>
      </div>
   </div>
</header>



<div class="container">
   <div class="col-sm-12">
   <h2 class="title text-center">Coupon</h2>
      <div class="col-sm-6">
         <!--  CAROUSEL -->
         <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
            <!-- Indicators -->
            <ol class="carousel-indicators">
               <li data-target="#carousel-example-generic" data-slide-to="@i" class="active"></li>
               @for(photo <- Photo.photosByCoupon(coupon)){
               @{i=i+1}
               <li data-target="#carousel-example-generic" data-slide-to="@i"></li>
               }
            </ol>
            <!-- Wrapper for slides -->
            <div class="carousel-inner" role="listbox">
               <div class="item active">
                  <img src="@routes.Assets.at(coupon.picture)"></img>
               </div>
               @for(photo <- Photo.photosByCoupon(coupon)){
               <div class="item">
                  <img src="@routes.Assets.at(photo.path)"></img>      
               </div>
               }
               ...
            </div>
            <!-- Controls -->
            <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
            <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
            </a>
            <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
            <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
            </a>
         </div>
         
                     <!-- ratings -->
      		<br>
            <div>
      @if(Sesija.getCurrentUser(ctx()) != null && Rate.alreadyRate(Sesija.getCurrentUser(ctx()).id) == false) {
      <label>Rate this coupon</label>
      	<form class="rating" action="@routes.RateController.rating(coupon.id)" method="POST">
       	<input id="rating" value="" name="rate"  class="auto-submit-star" min=0 max=5 step=1 data-size="xs" />
       	<br/>
       	<button type="submit" class="btn btn-default">Rate</button>
  		</form>
  		}
  		</div>
      
      <!--/ratings -->
         
      </div>
      <!-- END OF SLIDER -->	
      


      <div class="col-sm-6">
         <div class="product-information">
            <!--/product-information-->
            <div class="col-sm-12">
               <h2> @coupon.name </h2>
               <span>
               <p id="spanPrice"> @coupon.getPriceString() KM</p>
               @if(Sesija.adminCheck(ctx()) == false && Sesija.companyCheck(ctx()) == false) {
               @if(CouponController.isExpired(coupon.id)==false && coupon.maxOrder > 0) {
               <label>Enter the amount of coupons </label>
               <form action="/couponpurchase" method="POST" data-paypal-button="true">
                  <input type="text" id="coupon_id" name="coupon_id" value="@coupon.id" hidden/>
                  <input type="number" step="1" id="quantity" name="quantity" min="1" max=@coupon.maxOrder placeholder="0" required/>
                  <button type="submit" id="submit-buy" >
                  <img src="//www.paypalobjects.com/en_US/i/btn/btn_xpressCheckout.gif" alt="Check out with PayPal" />
                  </button>
               </form>
               }

                @if(coupon.maxOrder <= coupon.minOrder) {
	               <label><h3>Offer succeded </h3></label>
	               <br>
                }

               @if(CouponController.isExpired(coupon.id)==true) {
               <label>Coupon has expired </label>
              	 }
               }
               @if(Sesija.adminCheck(ctx()) == true) {
               <a href='@routes.CouponController.editCoupon(coupon.id)' class="btn btn-fefault cart">Update coupon</a>						
               <a href='@routes.CouponController.deleteCoupon(coupon.id)' onclick="return confirm('Are you sure you want to delete this coupon?');"
                  class="btn btn-fefault cart">Delete coupon</a>

                   @if(coupon.buyers.size() > 0) {
                  <a href="/refundCoupon/@coupon.id" class="btn btn-fefault cart" onclick="return confirm('Are you sure you want to refund?);">Refund</a>
             	  }
             	  
               	@if(CouponController.isExpired(coupon.id)==false && coupon.maxOrder > 0) {
	               <form action="/buyForUser" method="GET" >
	               	  <input id="coupon_id" name="coupon_id" type="text" value=@coupon.id hidden />
	               	  <input id="pin" name="pin" type="text" style="width: 150px;" maxlength="6" placeholder="Pin code" required/>
	                  <button type="submit" id="buy-for" class="btn btn-default" >Buy for User</button> 
	               </form>
              	 }
               }
                @if(Sesija.companyCheck(ctx()) == true && Coupon.ownedCoupons(Sesija.getCurrentCompany(ctx()).id).contains(coupon)) {
               <a href='@routes.CouponController.editCoupon(coupon.id)' class="btn btn-fefault cart">Update coupon</a>						
               <a href='@routes.CouponController.deleteCoupon(coupon.id)' onclick="return confirm('Are you sure you want to delete this coupon?');"
                  class="btn btn-fefault cart">Delete coupon</a>
                   @if(coupon.buyers.size() > 0) {
                  <a href="/refundCoupon/@coupon.id" class="btn btn-fefault cart" onclick="return confirm('Are you sure you want to refund?);">Refund</a>
             	  }
         	   }
         	   
      		  @if(CouponController.isExpired(coupon.id)==false) {
                <div class="pull-left">
                <label  >
               <p><h3>@CouponController.leftToSell(coupon.id)</h3> left to reach the offer goal !</p>
               </label>	
               </div>
              }
 
               <div>				
                  <textarea class="focusExpiration" disabled rows="1">@coupon.getExpiration()</textarea>
               </div>
               <br>
               
                <!-- rate preview -->
             
				<div class="rate">
				<label class="pull-left">Coupon rate</label>
			       <input id="rating" value="@Rate.progres(coupon.id)" name="rating" class="rating" min=0 max=5 step=1 data-size="xs" disabled/>
                 </div>
				<!-- /rate preview -->
               
               
               <div class="pull-left">
                  <label>Description</label>
                  <p/>@coupon.description</p>
               </div>
               <br>
               <div>
                  <label class="pull-left" >Remark</label>
                  <textarea disabled rows="4">@coupon.remark</textarea>
                  </br>
                  </br>
                  <label class="pull-left">Published by</label>

               <a href="@routes.CompanyController.showCompanyProfile(coupon.seller.id)">@coupon.seller.name</a>
               </br>
               </br>
               </div>
            
               <label class="pull-left">Number of views @coupon.statistic.visited</label>           
               </br>
               </br>
              
               </div>
         <!--/product-information-->
      </div>

   </div>
</div>
<!-- COMMENTS AND QUESTIONS -->
<div class="container">
   <div class="tabbable" id="tabs-706598">
      <ul class="nav nav-tabs">
         <li class="active">
            <a href="#panel-935988" data-toggle="tab">Comments</a>
         </li>
         <li>
            <a href="#panel-807788" data-toggle="tab">Questions</a>
         </li>
      </ul>
      <div class="tab-content">
         <div class="tab-pane active" id="panel-935988">
            <!-- comments -->   
            <div class="detailBox">
               <div class="titleBox">
                  <label>Comments</label>
                  <button type="button" class="close" aria-hidden="true">&times;</button>
               </div>
               <div class="actionBox">
                  <ul class="commentList">
                     @for(comment <- Comment.findByCoupon(coupon)){           	
                     <li>
                        <div class="commenterImage">
                           <img src="@routes.Assets.at(comment.user.profilePicture)" />
                        </div>
                        <div class="commentText">
                           <p class="">@comment.comment</p>
                           <span class="date sub-text">Comment by: @comment.user.username on @comment.date</span>					
                           <span style="margin-left:20px" title="Report this comment">
                           <a class="report" style="color:#2a6496" style="cursor: hand;" onClick="report(@comment.id)" ><i class="glyphicon glyphicon-ban-circle"> </i></a> 
                           </span>
                        </div>

                     </li>                     
                     
                     
                     }
                  </ul>
                  <br><br><br>
                  @if(Sesija.getCurrent(ctx()) != null){
                  @if(Sesija.getCurrent(ctx()).isUser()){

                  <form class="form" action="@routes.CommentController.comment(coupon.id)" method="POST">
                     <div class="form-group">
                        <textarea class="form-control" rows="5" id="comment" name="comment" placeholder="Your comments" required></textarea>
                     </div>
                     <div class="form-group">
                        <button type="submit" class="btn btn-default">Comment</button>
                     </div>
                  </form>    
   
                  }
                  }
               </div>
            </div>
         </div>
         <!-- Questions  -->
         <div class="tab-pane" id="panel-807788">
			 <div class="detailBox">   
               <div class="titleBox">
                  <label>Questions</label>
                  <button type="button" class="close" aria-hidden="true">&times;</button>
               </div>
               <div class="actionBox">
                  <ul class="questionList">
                     @for(question <- Question.findByCoupon(coupon)){           	
                     <li class="questionRow">
                        <div class="askerImage">
                           <img src="@routes.Assets.at(question.user.profilePicture)" />
                        </div>
                        <div class="commentText">
                           <p class="">@question.question</p>
                           <span class="date sub-text">Question by: @question.user.username on @question.questionDate</span>	
                     </li>  
                        @if(Sesija.getCurrentCompany(ctx()) == coupon.seller || Sesija.getCurrentUser(ctx()) == question.user){ 
		                     <form action="@routes.QuestionController.deleteQuestion(question.id)">
		                     	<button type="submit" class="btn btn-danger btn-link" onclick="return confirm('Delete question?');"><h6>Delete question</h6></button>	
		                     </form>	
                     	}
                     	<br>
                     	@if(Sesija.getCurrentCompany(ctx()) == coupon.seller){
		                     <li>
						         <form class="form-inline" action="@routes.QuestionController.addAnswer(question.id)" method="POST">
		                   <!--     <input class="form-control" id="answer" name="answer" type="text" placeholder="answer here" required/>  -->
		                            <textarea class="form-control" rows="2" cols="50" id="answer" name="answer" placeholder="answer here" required></textarea>
		                             <div class="form-group">
		                             @if(question.answer.length() == 0){
		                               <button type="submit" class="btn btn-warning btn-sm">Answer</button>
		                             }else{
		                                <button type="submit" class="btn btn-default btn-sm">Update</button>
		                             }
		                             </div>
		                         </form>                 
		                     </li> 
		                 }
		           </ul>
		          <ul class="answerList">
		                 @if(question.answer.length() > 0){
						     <li >                                  
						         <div class="answerText">
		                           <h6><company-color>@coupon.seller.name:</company-color>  @question.answer </h6>
		                           <span class="date sub-text">answered on @question.answerDate</span>					
		                         </div>								
							 </li>
					     }                	
                   </ul>
                     }
                  
                  <br><br><br>
                  
                  @if(Sesija.getCurrent(ctx()) != null){
                  @if(Sesija.getCurrent(ctx()).isUser()){
             <!-- <form class="form" id="questionForm">   -->	
                 <form class="form" action="@routes.QuestionController.addQuestion(coupon.id)" method="POST">   
                     <div class="form-group">
                  <!--  <input class="form-control" id="question" name="question" type="text" placeholder="Your question" />-->
                        <textarea class="form-control" rows="5" id="question" name="question" placeholder="Your question" required></textarea>
                     </div>
                     <div class="form-group">
                      <button type="submit" class="btn btn-default">Submit question</button>   
                   <!--  			 <button type="submit" id="question-button"  class="btn btn-default">Submit question</button>    -->
                     </div>
                  </form>    
   
                  }
                  }
               </div>
            </div>
         </div>
      </div>
   </div>
</div>

   <!-- AJAX HANDLE REPORT  -->
                <script>						
						function report(id) {		
							$.ajax({					
								  method: "GET",
								  url: "/report/" +id,							  
								  
								}).done(function(msg) {
									 console.log("FAILED");								 
								   	  alert( "You successfuly reported this comment." );
								 }).fail(function( msg ) {
									  console.log("FAILED");
									  console.log(msg);
									  console.log("ID IS "+id)
								   	  alert( "Reporting failed, please try again later." );
								  });
										e.preventDefault();
							}
						
			 		</script>
														
			        <script>
			        jQuery(document).ready(function() {
			            $('.auto-submit-star').rating({
			                callback: function(value, link){
			                    alert(value);
			                    this.rating('disable');
			                }
			            });
			        });
			        </script>


}
